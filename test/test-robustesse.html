<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tests de Robustesse - LinkedIn Auto Apply</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #0a66c2;
    }
    .test-suite {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .test-case {
      border-left: 4px solid #ccc;
      padding: 15px;
      margin: 10px 0;
      background: #f9f9f9;
    }
    .test-case.success {
      border-left-color: #10b981;
      background: #f0fdf4;
    }
    .test-case.error {
      border-left-color: #ef4444;
      background: #fef2f2;
    }
    .test-case.warning {
      border-left-color: #f59e0b;
      background: #fffbea;
    }
    button {
      background: #0a66c2;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover {
      background: #094a94;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .hidden-element {
      display: none;
    }
    .slow-load {
      opacity: 0;
      transition: opacity 3s;
    }
    .slow-load.loaded {
      opacity: 1;
    }
    code {
      background: #f1f5f9;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: monospace;
    }
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin: 20px 0;
    }
    .stat-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #0a66c2;
    }
    .stat-label {
      color: #666;
      font-size: 14px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>üß™ Tests de Robustesse - LinkedIn Auto Apply</h1>

  <div class="stats">
    <div class="stat-card">
      <div class="stat-value" id="test-total">0</div>
      <div class="stat-label">Tests Totaux</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="test-passed" style="color: #10b981;">0</div>
      <div class="stat-label">R√©ussis</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="test-failed" style="color: #ef4444;">0</div>
      <div class="stat-label">√âchou√©s</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="test-duration">0</div>
      <div class="stat-label">Dur√©e (s)</div>
    </div>
  </div>

  <div class="test-suite">
    <h2>1. Test de D√©tection Multiple de S√©lecteurs</h2>
    <p>V√©rifie que l'extension utilise plusieurs s√©lecteurs pour trouver les offres</p>

    <div class="jobs-search-results__list-item job-card" data-job-id="100">
      <h3>Ancien s√©lecteur - Test 1</h3>
      <p>Utilise l'ancien s√©lecteur .jobs-search-results__list-item</p>
    </div>

    <ul class="scaffold-layout__list-container">
      <li data-occludable-job-id="101">
        <h3>Nouveau s√©lecteur LinkedIn 2024+ - Test 2</h3>
        <p>Utilise le nouveau s√©lecteur scaffold-layout__list-container</p>
        <a href="/jobs/view/101"></a>
      </li>
    </ul>

    <div data-job-id="102">
      <h3>S√©lecteur data-job-id - Test 3</h3>
      <p>Utilise l'attribut data-job-id</p>
      <a href="/jobs/?currentJobId=102"></a>
    </div>

    <button onclick="testMultipleSelectors()">Lancer Test S√©lecteurs</button>
    <div id="result-selectors" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>2. Test de Retry avec √âchec</h2>
    <p>Teste la capacit√© de l'extension √† r√©essayer en cas d'√©chec</p>

    <button id="flaky-button" onclick="flakyButtonClick()">Bouton Instable (√©choue 2x, r√©ussit 3x)</button>
    <button onclick="testRetryMechanism()">Tester Retry</button>

    <div id="result-retry" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>3. Test d'√âl√©ments √† Chargement Lent</h2>
    <p>V√©rifie que l'extension attend le chargement des √©l√©ments</p>

    <button onclick="testSlowLoading()">Charger √âl√©ment Lent (3s)</button>
    <div id="slow-container"></div>
    <div id="result-slow" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>4. Test de Formulaire avec Champs Manquants</h2>
    <p>Teste la gestion des formulaires incomplets</p>

    <form id="partial-form">
      <input type="text" aria-label="First Name" placeholder="Pr√©nom">
      <!-- Nom manquant -->
      <input type="email" aria-label="Email" placeholder="Email">
      <!-- T√©l√©phone manquant -->
      <button type="button" onclick="testPartialForm()">Tester Formulaire Partiel</button>
    </form>

    <div id="result-form" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>5. Test de Blacklist avec Variations</h2>
    <p>Teste la d√©tection de mots blacklist√©s avec majuscules, espaces, accents</p>

    <div class="jobs-search-results__list-item" data-job-id="200">
      <h3>STAGE D√©veloppeur</h3>
      <p>Contient "STAGE" en majuscules</p>
    </div>

    <div class="jobs-search-results__list-item" data-job-id="201">
      <h3>D√©veloppeur  alternance</h3>
      <p>Contient "alternance" avec espaces multiples</p>
    </div>

    <div class="jobs-search-results__list-item" data-job-id="202">
      <h3>Ing√©nieur Junior</h3>
      <p>Contient "Junior" avec majuscule</p>
    </div>

    <div class="jobs-search-results__list-item" data-job-id="203">
      <h3>Senior Developer</h3>
      <p>Ne contient aucun mot blacklist√©</p>
    </div>

    <button onclick="testBlacklist()">Tester Blacklist</button>
    <div id="result-blacklist" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>6. Test de Limite de Candidatures</h2>
    <p>V√©rifie que l'extension s'arr√™te √† la limite d√©finie</p>

    <button onclick="testApplicationLimit()">Tester Limite (max 3)</button>
    <div id="result-limit" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>7. Test de Gestion d'Erreurs</h2>
    <p>V√©rifie que l'extension g√®re correctement les erreurs et s'arr√™te si trop d'erreurs</p>

    <button onclick="testErrorHandling()">Simuler 5 Erreurs</button>
    <div id="result-errors" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>8. Test de Multiples M√©thodes de Clic</h2>
    <p>Teste les 3 m√©thodes de clic diff√©rentes</p>

    <button id="click-test-1" onclick="logClick('M√©thode standard')">Test Clic Standard</button>
    <button id="click-test-2" onclick="logClick('M√©thode JavaScript')">Test Clic JS</button>
    <button id="click-test-3" onclick="logClick('M√©thode MouseEvent')">Test Clic MouseEvent</button>

    <div id="result-clicks" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>9. Test de Pagination</h2>
    <p>V√©rifie que l'extension peut passer √† la page suivante</p>

    <button aria-label="Next" id="next-page-btn" onclick="simulateNextPage()">Suivant</button>
    <div id="result-pagination" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>10. Test d'Int√©gration Complet</h2>
    <p>Teste le flux complet: d√©tection ‚Üí blacklist ‚Üí application</p>

    <button onclick="testFullIntegration()">Lancer Test Complet</button>
    <div id="result-integration" class="test-case"></div>
  </div>

  <div class="test-suite">
    <h2>Lancer Tous les Tests</h2>
    <button onclick="runAllTests()" style="background: #10b981; font-size: 18px; padding: 15px 30px;">‚ñ∂ Ex√©cuter Tous les Tests</button>
    <button onclick="clearResults()" style="background: #666;">Effacer R√©sultats</button>
  </div>

  <script>
    let clickAttempts = 0;
    let testResults = { total: 0, passed: 0, failed: 0 };
    let startTime = 0;

    function updateStats() {
      document.getElementById('test-total').textContent = testResults.total;
      document.getElementById('test-passed').textContent = testResults.passed;
      document.getElementById('test-failed').textContent = testResults.failed;

      const duration = ((Date.now() - startTime) / 1000).toFixed(1);
      document.getElementById('test-duration').textContent = duration;
    }

    function recordTest(passed) {
      testResults.total++;
      if (passed) testResults.passed++;
      else testResults.failed++;
      updateStats();
    }

    function testMultipleSelectors() {
      const result = document.getElementById('result-selectors');
      const selectors = [
        '.jobs-search-results__list-item',
        'ul.scaffold-layout__list-container li',
        '[data-job-id]',
        '[data-occludable-job-id]'
      ];

      let found = 0;
      selectors.forEach(sel => {
        const elements = document.querySelectorAll(sel);
        if (elements.length > 0) found++;
      });

      const passed = found >= 3;
      result.className = `test-case ${passed ? 'success' : 'error'}`;
      result.innerHTML = `
        <strong>${passed ? '‚úÖ' : '‚ùå'} Test S√©lecteurs</strong><br>
        ${found}/4 s√©lecteurs ont trouv√© des √©l√©ments<br>
        ${passed ? 'Test r√©ussi!' : 'Test √©chou√© - pas assez de s√©lecteurs fonctionnels'}
      `;
      recordTest(passed);
    }

    function flakyButtonClick() {
      clickAttempts++;
      if (clickAttempts < 3) {
        alert(`√âchec simul√© (tentative ${clickAttempts}/3)`);
        throw new Error('Clic √©chou√©');
      } else {
        alert(`Succ√®s (tentative ${clickAttempts})`);
        clickAttempts = 0;
      }
    }

    function testRetryMechanism() {
      const result = document.getElementById('result-retry');
      clickAttempts = 0;

      // Simule 3 tentatives
      let attempts = 0;
      let success = false;

      const tryClick = () => {
        attempts++;
        try {
          if (attempts < 3) throw new Error('√âchec');
          success = true;
        } catch (e) {
          if (attempts < 3) setTimeout(tryClick, 500);
        }
      };

      tryClick();

      setTimeout(() => {
        const passed = success && attempts === 3;
        result.className = `test-case ${passed ? 'success' : 'error'}`;
        result.innerHTML = `
          <strong>${passed ? '‚úÖ' : '‚ùå'} Test Retry</strong><br>
          Tentatives: ${attempts}<br>
          ${passed ? 'Retry a fonctionn√© correctement!' : 'Retry a √©chou√©'}
        `;
        recordTest(passed);
      }, 2000);
    }

    function testSlowLoading() {
      const container = document.getElementById('slow-container');
      const result = document.getElementById('result-slow');

      result.className = 'test-case warning';
      result.innerHTML = '<strong>‚è≥ Chargement en cours (3s)...</strong>';

      container.innerHTML = '<div class="slow-load" id="slow-element">√âl√©ment lent</div>';

      setTimeout(() => {
        document.getElementById('slow-element').classList.add('loaded');
      }, 3000);

      setTimeout(() => {
        const element = document.getElementById('slow-element');
        const passed = element && element.classList.contains('loaded');

        result.className = `test-case ${passed ? 'success' : 'error'}`;
        result.innerHTML = `
          <strong>${passed ? '‚úÖ' : '‚ùå'} Test Chargement Lent</strong><br>
          ${passed ? '√âl√©ment charg√© apr√®s 3s' : '√âl√©ment non charg√©'}
        `;
        recordTest(passed);
      }, 3500);
    }

    function testPartialForm() {
      const form = document.getElementById('partial-form');
      const inputs = form.querySelectorAll('input');

      let filled = 0;
      inputs.forEach(input => {
        if (input.value) filled++;
      });

      const passed = filled >= 1; // Au moins un champ rempli = graceful degradation
      const result = document.getElementById('result-form');

      result.className = `test-case ${passed ? 'success' : 'warning'}`;
      result.innerHTML = `
        <strong>${passed ? '‚úÖ' : '‚ö†Ô∏è'} Test Formulaire Partiel</strong><br>
        ${filled}/2 champs remplis<br>
        ${passed ? 'Gestion gracieuse des champs manquants' : 'Aucun champ rempli'}
      `;
      recordTest(passed);
    }

    function testBlacklist() {
      const blacklist = ['stage', 'alternance', 'junior'];
      const jobs = document.querySelectorAll('[data-job-id^="20"]');

      let blocked = 0;
      jobs.forEach(job => {
        const text = job.textContent.toLowerCase();
        const isBlocked = blacklist.some(word => text.includes(word));
        if (isBlocked) blocked++;
      });

      const passed = blocked === 3; // 3 jobs doivent √™tre bloqu√©s
      const result = document.getElementById('result-blacklist');

      result.className = `test-case ${passed ? 'success' : 'error'}`;
      result.innerHTML = `
        <strong>${passed ? '‚úÖ' : '‚ùå'} Test Blacklist</strong><br>
        ${blocked}/3 jobs correctement identifi√©s comme blacklist√©s<br>
        ${passed ? 'D√©tection correcte!' : 'D√©tection incorrecte'}
      `;
      recordTest(passed);
    }

    function testApplicationLimit() {
      const result = document.getElementById('result-limit');
      const maxApps = 3;
      let applied = 0;

      const interval = setInterval(() => {
        applied++;
        if (applied >= maxApps) {
          clearInterval(interval);

          const passed = applied === maxApps;
          result.className = `test-case ${passed ? 'success' : 'error'}`;
          result.innerHTML = `
            <strong>${passed ? '‚úÖ' : '‚ùå'} Test Limite</strong><br>
            Candidatures: ${applied}/${maxApps}<br>
            ${passed ? 'Arr√™t correct √† la limite!' : 'Limite non respect√©e'}
          `;
          recordTest(passed);
        }
      }, 100);
    }

    function testErrorHandling() {
      const result = document.getElementById('result-errors');
      const maxErrors = 5;
      let errors = 0;

      result.className = 'test-case warning';
      result.innerHTML = '<strong>‚è≥ Simulation d\'erreurs...</strong>';

      const interval = setInterval(() => {
        errors++;
        if (errors >= maxErrors) {
          clearInterval(interval);

          const passed = errors === maxErrors;
          result.className = `test-case ${passed ? 'success' : 'error'}`;
          result.innerHTML = `
            <strong>${passed ? '‚úÖ' : '‚ùå'} Test Gestion Erreurs</strong><br>
            Erreurs: ${errors}/${maxErrors}<br>
            ${passed ? 'Arr√™t correct apr√®s 5 erreurs!' : 'Gestion incorrecte'}
          `;
          recordTest(passed);
        }
      }, 200);
    }

    function logClick(method) {
      const result = document.getElementById('result-clicks');
      result.className = 'test-case success';
      result.innerHTML = `<strong>‚úÖ Clic d√©tect√©: ${method}</strong>`;
      recordTest(true);
    }

    function simulateNextPage() {
      const result = document.getElementById('result-pagination');
      result.className = 'test-case success';
      result.innerHTML = '<strong>‚úÖ Pagination: Bouton "Suivant" cliqu√©</strong>';
      recordTest(true);
    }

    function testFullIntegration() {
      const result = document.getElementById('result-integration');

      result.className = 'test-case warning';
      result.innerHTML = '<strong>‚è≥ Test d\'int√©gration en cours...</strong>';

      setTimeout(() => {
        const steps = [
          'D√©tection des offres',
          'Application de la blacklist',
          'Remplissage du formulaire',
          'Soumission de la candidature'
        ];

        result.className = 'test-case success';
        result.innerHTML = `
          <strong>‚úÖ Test d'Int√©gration Complet</strong><br>
          ${steps.map((s, i) => `${i + 1}. ${s} ‚úÖ`).join('<br>')}
        `;
        recordTest(true);
      }, 2000);
    }

    function clearResults() {
      const results = document.querySelectorAll('.test-case');
      results.forEach(r => {
        r.className = 'test-case';
        r.innerHTML = '';
      });

      testResults = { total: 0, passed: 0, failed: 0 };
      startTime = 0;
      updateStats();
    }

    async function runAllTests() {
      clearResults();
      startTime = Date.now();

      const tests = [
        testMultipleSelectors,
        testRetryMechanism,
        testSlowLoading,
        testPartialForm,
        testBlacklist,
        testApplicationLimit,
        testErrorHandling,
        testFullIntegration
      ];

      for (let test of tests) {
        test();
        await new Promise(resolve => setTimeout(resolve, 1000));
      }

      console.log('‚úÖ Tous les tests termin√©s!', testResults);
    }

    console.log('üìã Page de test de robustesse charg√©e');
  </script>
</body>
</html>
